# https://www.stigviewer.com/stig/tri-lab_operating_system_stack_toss_4/2022-08-29/finding/V-252939

# Verify there are no ."shosts" files on TOSS with the following command:
#
#     $ sudo find / -name '*.shosts'
#
# If any ."shosts" files are found, this is a finding.


- name: TOSS-04-010370 - There must be no ".shosts" files on The TOSS operating system.
  block:
    - name: TOSS-04-010370 - Register *.shosts files
      # as of 2024-12-02, ansible.builtin.find does not have the capability to include the '-xdev' option
      ansible.builtin.command: "find / -xdev -name '*.shosts'"
      check_mode: false
      changed_when: false
      register: shost_files

    - name: TOSS-04-010370 - Verify there are no .shosts files on the host
      ansible.builtin.assert:
        that:
          - shost_files.stdout_lines | length < 1
        fail_msg: "There should be no `*.shosts` files on the system"
        quiet: true
  ignore_errors: true
  when:
    - toss_04_010370 | bool
  tags:
    - V-252939
    - SRG-OS-000480-GPOS-00227
    - TOSS-04-010370
    - DISA-STIG-TOSS-04-010370
    - medium_severity
    - CCI-000366
