# https://www.stigviewer.com/stig/toss_4/2023-xx-xx/finding/V-252921

# Check to see that all public directories are owned by root or a
# system account with the following command: $ sudo find / -type d -perm -0002
# -exec ls -lLd {} \; drwxrwxrwxt 7 root root 4096 Jul 26 11:19 /tmp If any of the
# returned directories are not owned by root or a system account, this is a
# finding.


- name: TOSS-04-010100 - TOSS must prevent unauthorized and unintended information transfer via shared system resources.
  block:
    - name: Check to see if there are any public directories without an owner
      ansible.builtin.command: find / -nouser -type d -perm -0002 -ls # find / -type d -perm -0002 -exec ls -lLd {} \; # TODO FIND HANGS
      register: unowned_dirs
    - name: Set the owner of public directories without an owner to root
      ansible.builtin.file:
        path: "{{ item }}"
        user: root
      loop: "{{ unowned_dirs }}"
      when: unowned_dirs.stdout | length > 0
  when:
    - toss_04_010100 | bool
  tags:
    - V-252921
    - SRG-OS-000138-GPOS-00069
    - SV-252921r824087_rule
    - TOSS-04-010100
    - DISA-STIG-TOSS-04-010100
    - medium_severity
    - CCI-001090
